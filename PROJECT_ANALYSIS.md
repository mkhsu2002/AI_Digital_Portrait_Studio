# AI Digital Portrait Studio - å°ˆæ¡ˆåˆ†æèˆ‡å„ªåŒ–å»ºè­°

## ğŸ“‹ å°ˆæ¡ˆåŠŸèƒ½æ¦‚è¿°

é€™æ˜¯ä¸€å€‹åŸºæ–¼ React + Vite çš„ AI äººåƒæ”å½±æ£šæ‡‰ç”¨ï¼Œæ•´åˆ Google Gemini å½±åƒæ¨¡å‹èˆ‡ Firebase æœå‹™ï¼Œå”åŠ©å“ç‰Œå¿«é€Ÿç”Ÿæˆå¤šè¦–è§’çš„äººåƒå•†å“åœ–ã€‚

### æ ¸å¿ƒåŠŸèƒ½
1. **å¤šè¦–è§’å½±åƒç”Ÿæˆ**ï¼šä¸€æ¬¡ç”¢å‡ºå…¨èº«ã€åŠèº«ã€ç‰¹å¯«ä¸‰å¼µåœ–
2. **åƒè€ƒç´ æä¸Šå‚³**ï¼šæ”¯æ´äººç‰©è‡‰å­”èˆ‡å•†å“ç‰©ä»¶åƒè€ƒåœ–
3. **æ­·å²ç´€éŒ„ç®¡ç†**ï¼šæ¯ä½ä½¿ç”¨è€…ä¿ç•™æœ€è¿‘ 5 ç­†ç”Ÿæˆç´€éŒ„
4. **å‹•æ…‹å½±åƒå»¶ä¼¸**ï¼šå°‡åœ–ç‰‡è½‰æ›ç‚º 720p å‹•æ…‹å½±åƒï¼ˆVeo APIï¼‰
5. **ä½¿ç”¨è€…èªè­‰**ï¼šFirebase Authentication æä¾›å®Œæ•´ç™»å…¥æµç¨‹
6. **ä½¿ç”¨æ¬¡æ•¸ç®¡ç†**ï¼šè¿½è¹¤ä¸¦é™åˆ¶æ¯ä½ä½¿ç”¨è€…çš„ç”Ÿæˆæ¬¡æ•¸
7. **å¤šèªè¨€æ”¯æ´**ï¼šç¹é«”ä¸­æ–‡èˆ‡è‹±æ–‡åˆ‡æ›

---

## ğŸ—ï¸ ç¨‹å¼æ¶æ§‹åˆ†æ

### æŠ€è¡“æ£§
- **å‰ç«¯æ¡†æ¶**ï¼šReact 19 + TypeScript + Vite 6
- **ç‹€æ…‹ç®¡ç†**ï¼šReact Context API (AuthContext, TranslationContext)
- **å¾Œç«¯æœå‹™**ï¼šFirebase (Auth, Firestore, Storage)
- **AI æœå‹™**ï¼šGoogle Gemini API (`gemini-2.5-flash-image`), Veo API (`veo-3.1-fast-generate-preview`)
- **æ¨£å¼**ï¼šTailwind CSS
- **ä¾è³´ç®¡ç†**ï¼šnpm

### ç›®éŒ„çµæ§‹
```
â”œâ”€â”€ components/          # UI çµ„ä»¶
â”‚   â”œâ”€â”€ AuthGate.tsx    # èªè­‰é–˜é“
â”‚   â”œâ”€â”€ Header.tsx      # é é¦–
â”‚   â”œâ”€â”€ HistoryPanel.tsx # æ­·å²ç´€éŒ„é¢æ¿
â”‚   â”œâ”€â”€ PromptForm.tsx  # è¡¨å–®è¼¸å…¥
â”‚   â”œâ”€â”€ PromptDisplay.tsx # çµæœé¡¯ç¤º
â”‚   â””â”€â”€ icons/          # SVG åœ–ç¤ºçµ„ä»¶
â”œâ”€â”€ contexts/           # Context æä¾›è€…
â”‚   â”œâ”€â”€ AuthContext.tsx      # èªè­‰ç‹€æ…‹ç®¡ç†
â”‚   â””â”€â”€ TranslationContext.tsx # å¤šèªè¨€ç®¡ç†
â”œâ”€â”€ services/           # æ¥­å‹™é‚è¼¯æœå‹™
â”‚   â”œâ”€â”€ historyService.ts    # æ­·å²ç´€éŒ„ CRUD
â”‚   â””â”€â”€ usageService.ts      # ä½¿ç”¨æ¬¡æ•¸ç®¡ç†
â”œâ”€â”€ types.ts            # TypeScript å‹åˆ¥å®šç¾©
â”œâ”€â”€ constants.ts        # å¸¸æ•¸å®šç¾©ï¼ˆé¸é …åˆ—è¡¨ï¼‰
â”œâ”€â”€ firebase.ts         # Firebase åˆå§‹åŒ–
â””â”€â”€ App.tsx             # ä¸»æ‡‰ç”¨ç¨‹å¼
```

### è³‡æ–™æµ
1. **ä½¿ç”¨è€…èªè­‰æµç¨‹**ï¼šAuthGate â†’ AuthContext â†’ Firebase Auth
2. **è¡¨å–®è³‡æ–™æµ**ï¼šPromptForm â†’ App.tsx (formData state) â†’ API å‘¼å«
3. **åœ–ç‰‡ç”Ÿæˆæµç¨‹**ï¼šApp.tsx â†’ Gemini API â†’ åœ–ç‰‡ä¸Šå‚³è‡³ Storage â†’ æ­·å²ç´€éŒ„å¯«å…¥ Firestore
4. **æ­·å²ç´€éŒ„æµç¨‹**ï¼šHistoryPanel â†’ historyService â†’ Firestore â†’ App.tsx state

---

## ğŸ¯ å„ªåŒ–å»ºè­°é …ç›®

### ğŸ”´ é«˜å„ªå…ˆç´šï¼ˆå½±éŸ¿åŠŸèƒ½èˆ‡ç©©å®šæ€§ï¼‰

#### 1. **éŒ¯èª¤è™•ç†èˆ‡ä½¿ç”¨è€…é«”é©—**
**å•é¡Œ**ï¼š
- API éŒ¯èª¤è¨Šæ¯ä¸å¤ å‹å–„
- ç¶²è·¯éŒ¯èª¤æ™‚ç¼ºä¹é‡è©¦æ©Ÿåˆ¶
- åœ–ç‰‡ä¸Šå‚³å¤±æ•—æ™‚æ²’æœ‰æ˜ç¢ºæç¤º

**å»ºè­°**ï¼š
- å¯¦ä½œçµ±ä¸€çš„éŒ¯èª¤è™•ç†æ©Ÿåˆ¶ï¼ˆError Boundaryï¼‰
- ç‚º API å‘¼å«åŠ å…¥é‡è©¦é‚è¼¯ï¼ˆexponential backoffï¼‰
- æ”¹å–„éŒ¯èª¤è¨Šæ¯çš„æœ¬åœ°åŒ–èˆ‡å¯è®€æ€§
- åŠ å…¥ loading ç‹€æ…‹çš„é€²åº¦æŒ‡ç¤ºå™¨

#### 2. **æ•ˆèƒ½å„ªåŒ–**
**å•é¡Œ**ï¼š
- `App.tsx` æª”æ¡ˆéå¤§ï¼ˆ687 è¡Œï¼‰ï¼Œè·è²¬éå¤š
- åœ–ç‰‡ä»¥ base64 æ ¼å¼å„²å­˜åœ¨è¨˜æ†¶é«”ä¸­ï¼Œå¯èƒ½é€ æˆè¨˜æ†¶é«”å•é¡Œ
- æ­·å²ç´€éŒ„è¼‰å…¥æ™‚æ²’æœ‰åˆ†é æˆ–è™›æ“¬æ»¾å‹•

**å»ºè­°**ï¼š
- å°‡ `handleGenerate` èˆ‡ `handleGenerateVideo` æŠ½é›¢ç‚ºè‡ªè¨‚ Hook (`useImageGeneration.ts`)
- åœ–ç‰‡è™•ç†æ”¹ç‚ºä½¿ç”¨ Blob URL è€Œé base64
- æ­·å²ç´€éŒ„å¯¦ä½œè™›æ“¬æ»¾å‹•ï¼ˆreact-windowï¼‰æˆ–åˆ†é è¼‰å…¥
- ä½¿ç”¨ React.memo å„ªåŒ–å­çµ„ä»¶æ¸²æŸ“

#### 3. **å‹åˆ¥å®‰å…¨**
**å•é¡Œ**ï¼š
- `App.tsx` ä¸­æœ‰å¤šè™•ä½¿ç”¨ `any` å‹åˆ¥ï¼ˆå¦‚ `extractCandidates` å‡½æ•¸ï¼‰
- API å›æ‡‰çµæ§‹ç¼ºä¹æ˜ç¢ºçš„å‹åˆ¥å®šç¾©

**å»ºè­°**ï¼š
- å®šç¾©å®Œæ•´çš„ API å›æ‡‰å‹åˆ¥ï¼ˆ`GeminiResponse`, `VeoResponse` ç­‰ï¼‰
- ç§»é™¤æ‰€æœ‰ `any` å‹åˆ¥ï¼Œæ”¹ç”¨å…·é«”å‹åˆ¥æˆ– `unknown` + å‹åˆ¥å®ˆè¡›
- ä½¿ç”¨ Zod æˆ– Yup é€²è¡ŒåŸ·è¡Œæ™‚å‹åˆ¥é©—è­‰

---

### ğŸŸ¡ ä¸­å„ªå…ˆç´šï¼ˆæ”¹å–„ç¨‹å¼å“è³ªèˆ‡å¯ç¶­è­·æ€§ï¼‰

#### 4. **ç¨‹å¼ç¢¼çµ„ç¹”èˆ‡æ¨¡çµ„åŒ–**
**å•é¡Œ**ï¼š
- `App.tsx` åŒ…å«éå¤šæ¥­å‹™é‚è¼¯
- Prompt ç”Ÿæˆé‚è¼¯é‡è¤‡ï¼ˆé¡¯ç¤ºç”¨èˆ‡å¯¦éš›ç”Ÿæˆç”¨ï¼‰
- åœ–ç‰‡è™•ç†é‚è¼¯åˆ†æ•£åœ¨å¤šè™•

**å»ºè­°**ï¼š
- å»ºç«‹ `hooks/useImageGeneration.ts` è™•ç†åœ–ç‰‡ç”Ÿæˆé‚è¼¯
- å»ºç«‹ `utils/promptBuilder.ts` çµ±ä¸€ç®¡ç† prompt ç”Ÿæˆ
- å»ºç«‹ `utils/imageUtils.ts` è™•ç†åœ–ç‰‡è½‰æ›èˆ‡ä¸Šå‚³
- å°‡å¸¸æ•¸èˆ‡é…ç½®æŠ½é›¢åˆ°ç¨ç«‹æª”æ¡ˆ

#### 5. **ç‹€æ…‹ç®¡ç†å„ªåŒ–**
**å•é¡Œ**ï¼š
- å¤šå€‹ç›¸é—œç‹€æ…‹åˆ†æ•£ç®¡ç†ï¼ˆimages, isLoading, errorï¼‰
- æ­·å²ç´€éŒ„èˆ‡è¡¨å–®ç‹€æ…‹è€¦åˆåº¦é«˜

**å»ºè­°**ï¼š
- ä½¿ç”¨ `useReducer` ç®¡ç†è¤‡é›œç‹€æ…‹ï¼ˆå¦‚ç”Ÿæˆæµç¨‹ç‹€æ…‹æ©Ÿï¼‰
- è€ƒæ…®å¼•å…¥ Zustand æˆ– Jotai é€²è¡Œè¼•é‡ç´šç‹€æ…‹ç®¡ç†
- å°‡æ­·å²ç´€éŒ„ç‹€æ…‹æŠ½é›¢ç‚ºç¨ç«‹ Hook

#### 6. **API å‘¼å«å„ªåŒ–**
**å•é¡Œ**ï¼š
- API Key ç›´æ¥æš´éœ²åœ¨å‰ç«¯ç¨‹å¼ç¢¼ä¸­
- æ²’æœ‰ API å‘¼å«çš„çµ±ä¸€å°è£å±¤
- ç¼ºä¹è«‹æ±‚å–æ¶ˆæ©Ÿåˆ¶ï¼ˆä½¿ç”¨è€…é›¢é–‹é é¢æ™‚ï¼‰

**å»ºè­°**ï¼š
- å»ºç«‹ `services/apiClient.ts` çµ±ä¸€ç®¡ç† API å‘¼å«
- å¯¦ä½œè«‹æ±‚å–æ¶ˆæ©Ÿåˆ¶ï¼ˆAbortControllerï¼‰
- è€ƒæ…®å°‡æ•æ„Ÿ API å‘¼å«ç§»è‡³å¾Œç«¯ï¼ˆå¦‚ä½¿ç”¨ Cloud Functionsï¼‰
- åŠ å…¥è«‹æ±‚å»é‡ï¼ˆdeduplicationï¼‰æ©Ÿåˆ¶

#### 7. **æ¸¬è©¦è¦†è“‹**
**å•é¡Œ**ï¼š
- å°ˆæ¡ˆä¸­æ²’æœ‰æ¸¬è©¦æª”æ¡ˆ
- ç¼ºä¹å–®å…ƒæ¸¬è©¦èˆ‡æ•´åˆæ¸¬è©¦

**å»ºè­°**ï¼š
- ä½¿ç”¨ Vitest é€²è¡Œå–®å…ƒæ¸¬è©¦
- ä½¿ç”¨ React Testing Library æ¸¬è©¦çµ„ä»¶
- ç‚ºé—œéµæ¥­å‹™é‚è¼¯ï¼ˆå¦‚ `usageService`, `historyService`ï¼‰æ’°å¯«æ¸¬è©¦
- åŠ å…¥ E2E æ¸¬è©¦ï¼ˆä½¿ç”¨ Playwright æˆ– Cypressï¼‰

---

### ğŸŸ¢ ä½å„ªå…ˆç´šï¼ˆåŠŸèƒ½å¢å¼·èˆ‡ä½¿ç”¨è€…é«”é©—ï¼‰

#### 8. **ä½¿ç”¨è€…é«”é©—æ”¹å–„**
**å•é¡Œ**ï¼š
- åœ–ç‰‡ç”Ÿæˆæ™‚æ²’æœ‰é€²åº¦å›é¥‹
- ç„¡æ³•é è¦½ä¸Šå‚³çš„åƒè€ƒåœ–ç‰‡
- æ­·å²ç´€éŒ„ç„¡æ³•åˆªé™¤

**å»ºè­°**ï¼š
- åŠ å…¥åœ–ç‰‡ç”Ÿæˆé€²åº¦æ¢ï¼ˆå¦‚æœ API æ”¯æ´ï¼‰
- ç‚ºä¸Šå‚³çš„åƒè€ƒåœ–ç‰‡åŠ å…¥é è¦½åŠŸèƒ½
- æ­·å²ç´€éŒ„åŠ å…¥åˆªé™¤åŠŸèƒ½
- åŠ å…¥éµç›¤å¿«æ·éµæ”¯æ´
- æ”¹å–„éŸ¿æ‡‰å¼è¨­è¨ˆï¼ˆè¡Œå‹•è£ç½®é«”é©—ï¼‰

#### 9. **æ•ˆèƒ½ç›£æ§èˆ‡åˆ†æ**
**å•é¡Œ**ï¼š
- ç¼ºä¹æ•ˆèƒ½ç›£æ§æ©Ÿåˆ¶
- ç„¡æ³•è¿½è¹¤ä½¿ç”¨è€…è¡Œç‚º

**å»ºè­°**ï¼š
- æ•´åˆ Google Analytics æˆ– Firebase Analytics
- åŠ å…¥æ•ˆèƒ½æŒ‡æ¨™è¿½è¹¤ï¼ˆLCP, FID, CLSï¼‰
- è¨˜éŒ„ API å‘¼å«æ™‚é–“èˆ‡éŒ¯èª¤ç‡
- åŠ å…¥ Sentry é€²è¡ŒéŒ¯èª¤è¿½è¹¤

#### 10. **å®‰å…¨æ€§å¼·åŒ–**
**å•é¡Œ**ï¼š
- API Key æš´éœ²åœ¨å‰ç«¯
- æ²’æœ‰è¼¸å…¥é©—è­‰èˆ‡æ¸…ç†æ©Ÿåˆ¶
- æª”æ¡ˆä¸Šå‚³æ²’æœ‰å¤§å°èˆ‡æ ¼å¼é™åˆ¶

**å»ºè­°**ï¼š
- å¯¦ä½œæª”æ¡ˆå¤§å°é™åˆ¶ï¼ˆå‰ç«¯èˆ‡å¾Œç«¯ï¼‰
- åŠ å…¥æª”æ¡ˆé¡å‹é©—è­‰
- ä½¿ç”¨ Firebase Security Rules ä¿è­· Firestore èˆ‡ Storage
- è€ƒæ…®ä½¿ç”¨ Cloud Functions ä½œç‚º API ä»£ç†å±¤

#### 11. **åœ‹éš›åŒ–æ”¹å–„**
**å•é¡Œ**ï¼š
- ç¿»è­¯å…§å®¹ç¡¬ç·¨ç¢¼åœ¨ `TranslationContext.tsx` ä¸­
- ç„¡æ³•å‹•æ…‹è¼‰å…¥èªè¨€åŒ…

**å»ºè­°**ï¼š
- å°‡ç¿»è­¯å…§å®¹æŠ½é›¢ç‚º JSON æª”æ¡ˆ
- ä½¿ç”¨ i18next æˆ– react-intl é€²è¡Œåœ‹éš›åŒ–ç®¡ç†
- æ”¯æ´æ›´å¤šèªè¨€ï¼ˆæ—¥æ–‡ã€éŸ“æ–‡ç­‰ï¼‰

#### 12. **ç¨‹å¼ç¢¼å“è³ªå·¥å…·**
**å•é¡Œ**ï¼š
- æ²’æœ‰ ESLint æˆ– Prettier è¨­å®š
- ç¼ºä¹ç¨‹å¼ç¢¼æ ¼å¼åŒ–è¦ç¯„

**å»ºè­°**ï¼š
- åŠ å…¥ ESLint + TypeScript ESLint
- è¨­å®š Prettier é€²è¡Œè‡ªå‹•æ ¼å¼åŒ–
- åŠ å…¥ pre-commit hooksï¼ˆä½¿ç”¨ husky + lint-stagedï¼‰
- è¨­å®š CI/CD æµç¨‹ï¼ˆGitHub Actionsï¼‰

---

## ğŸ“Š å„ªå…ˆç´šç¸½çµ

### ç«‹å³è™•ç†ï¼ˆæœ¬é€±ï¼‰
1. âœ… éŒ¯èª¤è™•ç†æ”¹å–„
2. âœ… å°‡ `App.tsx` æ‹†åˆ†ç‚ºå¤šå€‹ Hook
3. âœ… ç§»é™¤ `any` å‹åˆ¥ï¼Œå®šç¾©å®Œæ•´å‹åˆ¥

### çŸ­æœŸæ”¹å–„ï¼ˆæœ¬æœˆï¼‰
4. âœ… æ¨¡çµ„åŒ–é‡æ§‹ï¼ˆæŠ½é›¢æ¥­å‹™é‚è¼¯ï¼‰
5. âœ… åŠ å…¥åŸºæœ¬æ¸¬è©¦
6. âœ… å¯¦ä½œæª”æ¡ˆä¸Šå‚³é©—è­‰

### é•·æœŸå„ªåŒ–ï¼ˆä¸‹å­£åº¦ï¼‰
7. âœ… å¼•å…¥ç‹€æ…‹ç®¡ç†åº«ï¼ˆå¦‚éœ€è¦ï¼‰
8. âœ… åŠ å…¥æ•ˆèƒ½ç›£æ§
9. âœ… æ”¹å–„åœ‹éš›åŒ–æ¶æ§‹

---

## ğŸ”§ å…·é«”å¯¦ä½œå»ºè­°

### ç¯„ä¾‹ï¼šæ‹†åˆ† `useImageGeneration` Hook

```typescript
// hooks/useImageGeneration.ts
export const useImageGeneration = () => {
  const [isLoading, setIsLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);
  const [images, setImages] = useState<ImageResult[]>([]);
  
  const generateImages = useCallback(async (formData: FormDataState) => {
    // åœ–ç‰‡ç”Ÿæˆé‚è¼¯
  }, []);
  
  return { generateImages, isLoading, error, images };
};
```

### ç¯„ä¾‹ï¼šçµ±ä¸€ API å®¢æˆ¶ç«¯

```typescript
// services/apiClient.ts
class ApiClient {
  private apiKey: string;
  
  async generateImage(prompt: string, config: ImageConfig): Promise<ImageResult> {
    // çµ±ä¸€çš„ API å‘¼å«é‚è¼¯
  }
  
  async generateVideo(imageSrc: string, config: VideoConfig): Promise<VideoResult> {
    // çµ±ä¸€çš„ API å‘¼å«é‚è¼¯
  }
}
```

---

## ğŸ“ çµè«–

é€™å€‹å°ˆæ¡ˆæ•´é«”æ¶æ§‹æ¸…æ™°ï¼ŒåŠŸèƒ½å®Œæ•´ï¼Œä½†åœ¨ç¨‹å¼ç¢¼çµ„ç¹”ã€éŒ¯èª¤è™•ç†èˆ‡æ¸¬è©¦è¦†è“‹æ–¹é¢æœ‰æ”¹å–„ç©ºé–“ã€‚å»ºè­°å„ªå…ˆè™•ç†é«˜å„ªå…ˆç´šé …ç›®ï¼Œé€æ­¥é‡æ§‹ä»¥æå‡ç¨‹å¼ç¢¼å“è³ªèˆ‡å¯ç¶­è­·æ€§ã€‚







